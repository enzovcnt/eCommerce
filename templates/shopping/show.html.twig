{% extends 'base.html.twig' %}

{% block body %}

    <hr>
    <p><strong>{{ product.name }}</strong></p>
    <p>{{ product.description }}</p>
    <p>{{ product.price }} $</p>
    <p>{{ product.stock }} kg</p>
    {% include('shopping/productQuantity.html.twig') %}
    {% if averageStars is not null %}
        <p>Moyenne des notes : {{ averageStars|number_format(1) }}/5</p>
    {% else %}
        <p>Ce produit n'a pas encore été noté.</p>
    {% endif %}
    <a href="{{ path('app_shopping') }}">retour</a>
    <hr>


    <div>
        {{ form_start(formComment, {
            'action': path('app_comment', {id: product.id}),
            'method': 'POST',
        }) }}

        {{ form_row(formComment.content) }}
        {{ form_row(formComment.stars) }}

        <button type="submit">
            Envoyer
        </button>

        {{ form_end(formComment) }}
    </div>

    <div>
    {% for comment in product.comments %}
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
            <p><strong>{{ comment.author.name }}</strong></p>
            <p>{{ comment.content }}</p>
            <p>Note de l'avis : {{ comment.stars }}/5</p>

            {% set average = comment.commentRates|length > 0
                ? (comment.commentRates|map(rate => rate.rate)|reduce((carry, rate) => carry + rate)/comment.commentRates|length)
                : null %}

            {% if average is not null %}
                <p>Utile ? Moyenne : {{ average|number_format(1) }}/5</p>
            {% else %}
                <p>Aucun vote sur ce commentaire.</p>
            {% endif %}


                <a href="{{ path('app_comment_rate', {id: comment.id}) }}">Donner votre avis sur ce commentaire</a>

        </div>
    {% endfor %}

{% endblock %}